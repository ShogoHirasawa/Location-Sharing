<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>1hour LocationSharing</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js"></script>
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        height: 100vh;
      }
      #map {
        flex: 1;
        position: relative;
      }
      #url-window {
        position: fixed;
        bottom: 20px;
        left: 20px;
        right: 20px;
        height: 60px;
        background-color: white;
        padding: 10px;
      }
      #url {
        width: 100%;
        font-size: 16px;
      }
      #help-window {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        max-width: 600px;
        height: 70%;
        max-height: 600px;
        background-color: white;
        padding: 10px;
        z-index: 999;
        overflow-y: scroll;
        display: none;
      }
      #help-window h1 {
        font-size: 24px;
      }
      #help-window h2 {
        font-size: 20px;
      }
      #help-window p {
        font-size: 16px;
        line-height: 1.5;
      }
      #help-window ol {
        margin-left: 20px;
      }
      #help-window .close-button {
        position: absolute;
        top: 5px;
        right: 5px;
        cursor: pointer;
      }
      @media screen and (min-width: 768px) {
        #url-window {
          width: 300px;
          left: auto;
          right: 20px;
          bottom: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div id="url-window">
      <span>ä»–ã®äººã¨å…±æœ‰ã™ã‚‹ãŸã‚ã®URL:</span>
      <br />
      <input id="url" type="text" readonly />
    </div>
    <div id="help-window">
      <h1>1hour LocationSharing</h1>
      <p>
        ç¾åœ¨ã®ä½ç½®æƒ…å ±ã‚’1æ™‚é–“é™å®šã§å…±æœ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã£ã¦ã€å…±æœ‰ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚
      </p>
      <p>
        å…±æœ‰æ™‚ç‚¹ã®ä½ç½®æƒ…å ±ã®ã¿ãŒå…±æœ‰ã•ã‚Œã¾ã™ã€‚ä½¿ç”¨è€…ãŒç§»å‹•ã—ãŸå ´åˆã¯ã€å†åº¦ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€æ–°ã—ã„ä½ç½®æƒ…å ±ã®URLã‚’å…±æœ‰ã‚’ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚ï¼ˆä»Šå¾Œã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§1ã¤ã®URLã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ä½ç½®æƒ…å ±ã‚’å…±æœ‰ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ğŸ™‡ï¼‰
      </p>
      <h2>æ‰‹é †</h2>
      <ol>
        <li>ä½ç½®æƒ…å ±ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¾ã™ã€‚</li>
        <li>åœ°å›³ã‚’æ‹¡å¤§/ç¸®å°ã—ã€è‡ªåˆ†ã®ç¾åœ¨ä½ç½®ã‚’ç¢ºèªã—ã¾ã™ã€‚</li>
        <li>å³ä¸‹ã«ã‚ã‚‹URLæ¬„ã«è¡¨ç¤ºã•ã‚Œã‚‹URLã‚’ã‚³ãƒ”ãƒ¼ã—ã€ä»–ã®äººã¨å…±æœ‰ã—ã¾ã™ã€‚</li>
        <li>ï¼‘æ™‚é–“å¾Œã«è‡ªå‹•çš„ã«å…±æœ‰ã¯è§£é™¤ã•ã‚Œã¾ã™ã€‚</li>
      </ol>
      <div class="close-button">âœ–</div>
    </div>
    <script>
      mapboxgl.accessToken =
        "pk.eyJ1Ijoic2hvZ29oaXJhc2F3YSIsImEiOiJjazFhbzVrMG0yNmxjM2xuaTBmM3h0dW4wIn0.Bxjy09jy_cwOQVexF1xBfg";
      var map = new mapboxgl.Map({
        container: "map",
        style: "mapbox://styles/shogohirasawa/cl4j827v7000h15nrbum0t2x6",
        center: [139.767052, 35.681167],
        zoom: 12,
      });
      var marker = new mapboxgl.Marker();
      var sharing = false;
      var url = "";

      function startSharing() {
        sharing = true;
        var timer = setInterval(function () {
          updateUrl();
        }, 5000);
      }

      function stopSharing() {
        sharing = false;
        clearInterval(timer);
        url = "";
        marker.remove();
        map.flyTo({ center: [139.767052, 35.681167], zoom: 12 });
        document.getElementById("url").value = "";
      }

      function updateUrl() {
        navigator.geolocation.getCurrentPosition(function (position) {
          var lng = position.coords.longitude;
          var lat = position.coords.latitude;
          var timestamp = new Date().getTime();
          var newUrl =
            window.location.href.split("?")[0] +
            "?lat=" +
            lat.toFixed(6) +
            "&lng=" +
            lng.toFixed(6) +
            "&timestamp=" +
            timestamp;
          if (newUrl !== url) {
            url = newUrl;
            marker.setLngLat([lng, lat]).addTo(map);
            map.flyTo({ center: [lng, lat], zoom: 14 });
            document.getElementById("url").value = url;
          }
        });
      }

      map.on("load", function () {
        updateUrl();
        startSharing();
      });

      // Add event listener to show/hide help window
      var helpWindow = document.getElementById("help-window");
      var closeButton = helpWindow.querySelector(".close-button");
      closeButton.addEventListener("click", function () {
        helpWindow.style.display = "none";
      });
      window.addEventListener("load", function () {
        helpWindow.style.display = "block";
      });

      // Update UI on window resize
      window.addEventListener("resize", function () {
        if (window.innerWidth >= 768) {
          document.body.classList.remove("mobile");
        } else document.body.classList.add("mobile");
      }); // Add event listener to start sharing button
      var startButton = document.getElementById("start-sharing");
      startButton.addEventListener("click", function () {
        startSharing();
        document.getElementById("url-window").style.display = "block";
      });

      // Add event listener to stop sharing button
      var stopButton = document.getElementById("stop-sharing");
      stopButton.addEventListener("click", function () {
        stopSharing();
        document.getElementById("url-window").style.display = "none";
      }); // Add event listener to start sharing button
      var startButton = document.getElementById("start-sharing");
      startButton.addEventListener("click", function () {
        startSharing();
        document.getElementById("url-window").style.display = "block";
      });

      // Add event listener to stop sharing button
      var stopButton = document.getElementById("stop-sharing");
      stopButton.addEventListener("click", function () {
        stopSharing();
        document.getElementById("url-window").style.display = "none";
      });
    </script>
  </body>
</html>
